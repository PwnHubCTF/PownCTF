<template>
  <div class="bg-primary">
    <div class="py-4 px-3 h-full flex flex-col justify-between">
      <!-- Top -->
      <div>
        <!-- Menu -->
        <ul>
          <li>
            <NuxtLink
              v-if="$auth.loggedIn && $auth.user.role >= 2"
              to="/admin/challenges"
              class="flex justify-center showLogout mb-6 p-2 text-base font-normal rounded-lg text-gray-100 bg-secondary hover:bg-opacity-90"
            >
              <svg
                aria-hidden="true"
                class="menuIcon hidden sm:block"
                fill="currentColor"
                width="24"
                height="24"
                viewBox="0 0 512 512"
              >
                <path
                  d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z"
                />
              </svg>
              <span class="hidden sm:block mx-8">Admin</span>
              <svg
                aria-hidden="true"
                class="menuIcon"
                fill="currentColor"
                width="24"
                height="24"
                viewBox="0 0 512 512"
              >
                <path
                  d="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z"
                />
              </svg>
            </NuxtLink>
            <NuxtLink to="/" class="menuText group mb-8 flex justify-center">
              <img style="max-height: 50px" src="/api/configs/logo" alt="" />
            </NuxtLink>
            <NuxtLink
              v-if="$auth.loggedIn"
              to="/profile"
              class="menuText group"
            >
              <svg
                aria-hidden="true"
                class="menuIcon"
                fill="currentColor"
                width="24"
                height="24"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 2c2.757 0 5 2.243 5 5.001 0 2.756-2.243 5-5 5s-5-2.244-5-5c0-2.758 2.243-5.001 5-5.001zm0-2c-3.866 0-7 3.134-7 7.001 0 3.865 3.134 7 7 7s7-3.135 7-7c0-3.867-3.134-7.001-7-7.001zm6.369 13.353c-.497.498-1.057.931-1.658 1.302 2.872 1.874 4.378 5.083 4.972 7.346h-19.387c.572-2.29 2.058-5.503 4.973-7.358-.603-.374-1.162-.811-1.658-1.312-4.258 3.072-5.611 8.506-5.611 10.669h24c0-2.142-1.44-7.557-5.631-10.647z"
                />
              </svg>
              <div class="ml-3 hidden sm:block">
                <span class="">{{ $auth.user.pseudo | truncate(12) }}</span>
              </div>
            </NuxtLink>
            <NuxtLink
              v-if="$auth.loggedIn && $store.state.ctfOptions.teamMode === true"
              to="/team"
              class="menuText group"
            >
              <svg
                aria-hidden="true"
                class="menuIcon"
                fill="currentColor"
                width="24"
                height="24"
                viewBox="0 0 640 512"
              >
                <path
                  d="M144 160c-44.2 0-80-35.8-80-80S99.8 0 144 0s80 35.8 80 80s-35.8 80-80 80zm368 0c-44.2 0-80-35.8-80-80s35.8-80 80-80s80 35.8 80 80s-35.8 80-80 80zM0 298.7C0 239.8 47.8 192 106.7 192h42.7c15.9 0 31 3.5 44.6 9.7c-1.3 7.2-1.9 14.7-1.9 22.3c0 38.2 16.8 72.5 43.3 96c-.2 0-.4 0-.7 0H21.3C9.6 320 0 310.4 0 298.7zM405.3 320c-.2 0-.4 0-.7 0c26.6-23.5 43.3-57.8 43.3-96c0-7.6-.7-15-1.9-22.3c13.6-6.3 28.7-9.7 44.6-9.7h42.7C592.2 192 640 239.8 640 298.7c0 11.8-9.6 21.3-21.3 21.3H405.3zM416 224c0 53-43 96-96 96s-96-43-96-96s43-96 96-96s96 43 96 96zM128 485.3C128 411.7 187.7 352 261.3 352H378.7C452.3 352 512 411.7 512 485.3c0 14.7-11.9 26.7-26.7 26.7H154.7c-14.7 0-26.7-11.9-26.7-26.7z"
                />
              </svg>
              <span class="ml-3">Team</span>
            </NuxtLink>
            <NuxtLink to="/scoreboard" class="menuText group">
              <svg
                aria-hidden="true"
                class="menuIcon"
                fill="currentColor"
                viewBox="0 0 576 512"
              >
                <path
                  d="M400 0H176c-26.5 0-48.1 21.8-47.1 48.2c.2 5.3 .4 10.6 .7 15.8H24C10.7 64 0 74.7 0 88c0 92.6 33.5 157 78.5 200.7c44.3 43.1 98.3 64.8 138.1 75.8c23.4 6.5 39.4 26 39.4 45.6c0 20.9-17 37.9-37.9 37.9H192c-17.7 0-32 14.3-32 32s14.3 32 32 32H384c17.7 0 32-14.3 32-32s-14.3-32-32-32H357.9C337 448 320 431 320 410.1c0-19.6 15.9-39.2 39.4-45.6c39.9-11 93.9-32.7 138.2-75.8C542.5 245 576 180.6 576 88c0-13.3-10.7-24-24-24H446.4c.3-5.2 .5-10.4 .7-15.8C448.1 21.8 426.5 0 400 0zM48.9 112h84.4c9.1 90.1 29.2 150.3 51.9 190.6c-24.9-11-50.8-26.5-73.2-48.3c-32-31.1-58-76-63-142.3zM464.1 254.3c-22.4 21.8-48.3 37.3-73.2 48.3c22.7-40.3 42.8-100.5 51.9-190.6h84.4c-5.1 66.3-31.1 111.2-63 142.3z"
                />
              </svg>
              <span class="ml-3">Scoreboard</span>
            </NuxtLink>
            <NuxtLink to="/users" class="menuText group">
              <svg
                aria-hidden="true"
                class="menuIcon"
                fill="currentColor"
                width="24"
                height="24"
                viewBox="0 0 640 512"
              >
                <path
                  d="M96 128a128 128 0 1 1 256 0A128 128 0 1 1 96 128zM0 482.3C0 383.8 79.8 304 178.3 304h91.4C368.2 304 448 383.8 448 482.3c0 16.4-13.3 29.7-29.7 29.7H29.7C13.3 512 0 498.7 0 482.3zM609.3 512H471.4c5.4-9.4 8.6-20.3 8.6-32v-8c0-60.7-27.1-115.2-69.8-151.8c2.4-.1 4.7-.2 7.1-.2h61.4C567.8 320 640 392.2 640 481.3c0 17-13.8 30.7-30.7 30.7zM432 256c-31 0-59-12.6-79.3-32.9C372.4 196.5 384 163.6 384 128c0-26.8-6.6-52.1-18.3-74.3C384.3 40.1 407.2 32 432 32c61.9 0 112 50.1 112 112s-50.1 112-112 112z"
                />
              </svg>
              <div class="ml-3 hidden sm:block">
                <span class="">Players</span>
              </div>
            </NuxtLink>
          </li>
        </ul>
        <!-- Categories List -->
        <div
          class="pt-11"
          v-if="$auth.loggedIn && $store.state.ctfOptions.state !== 'waiting'"
        >
          <span class="text-gray-600 text-center font-medium hidden sm:block"
            >Challenges</span
          >
          <ul>
            <li
              v-for="category in categories"
              :key="category.name"
              @click="tryToScroll(category.name)"
            >
              <NuxtLink :to="category.goto" class="menuText group">
                <div v-html="$options.filters.svgCatgeory(category.name)"></div>
                <span class="ml-3 capitalize">{{ category.name }}</span>
              </NuxtLink>
            </li>
          </ul>
        </div>
      </div>
      <!-- Bottom -->
      <div>
        <p
          class="w-40 text-gray-600 text-opacity-40 italic cursor-default pointer-events-none"
        >
          This platform is still in Beta. If you found any problem, please
          contact Eteck#3426 on Discord
        </p>
        <div class="menuText group cursor-pointer" @click="userLogout">
          <svg
            class="z-40 w-6 h-6 text-red-500 transition duration-200"
            fill="currentColor"
            width="24"
            height="24"
            viewBox="0 0 24 24"
          >
            <path
              d="M10 9.408l2.963 2.592-2.963 2.592v-1.592h-8v-2h8v-1.592zm-2-4.408v4h-8v6h8v4l8-7-8-7zm6-3c-1.787 0-3.46.474-4.911 1.295l.228.2 1.396 1.221c1.004-.456 2.114-.716 3.287-.716 4.411 0 8 3.589 8 8s-3.589 8-8 8c-1.173 0-2.283-.26-3.288-.715l-1.396 1.221-.228.2c1.452.82 3.125 1.294 4.912 1.294 5.522 0 10-4.477 10-10s-4.478-10-10-10z"
            />
          </svg>
          <span class="ml-3">Logout</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {};
  },
  computed: {
    categories() {
      return this.$store.state.categories.map((c) => {
        return {
          goto: "/challenges#" + c,
          name: c,
        };
      });
    },
  },
  methods: {
    tryToScroll(category) {
      let el = document.querySelector(`#${category.toLowerCase()}`);
      if (el) {
        el.animate(
          [
            // keyframes
            { transform: "translateX(0px)" },
            { transform: "translateX(-10px)" },
            { transform: "translateX(0px)" },
          ],
          {
            // timing options
            duration: 400,
          }
        );
        el.scrollIntoView({ behavior: "smooth" });
      }
    },
    async userLogout() {
      try {
        await this.$auth.logout();
      } catch (err) {
        this.$toast.error("Cannot logout.. IMPOSSIBLE");
      }
    },
  },
  async mounted() {
    let categories = await this.$api.challenges.getCategories();
    this.$store.commit("setCategories", categories);
  },
};
</script>
